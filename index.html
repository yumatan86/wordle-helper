<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Wordle Helper - „Éû„ÇπÁõÆÁâà</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 50px);
      grid-gap: 8px;
      justify-content: center;
      margin-bottom: 10px;
    }
    .cell {
      width: 50px;
      height: 50px;
      font-size: 24px;
      text-transform: uppercase;
      text-align: center;
      line-height: 50px;
      border: 2px solid #ccc;
      border-radius: 4px;
      user-select: none;
      outline: none;
    }
    .gray { background-color: #d3d6da; color: #000; }
    .yellow { background-color: #c9b458; color: #fff; }
    .green { background-color: #6aaa64; color: #fff; }
    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .controls button {
      padding: 5px 10px;
      font-size: 14px;
    }
    button.search {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
    }
    #results {
      background: white;
      padding: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>Wordle Helper</h1>
  <div id="grid" class="grid"></div>
  <div class="controls">
    <button onclick="setColor('gray')">‚¨ú ÁÅ∞</button>
    <button onclick="setColor('yellow')">üü® ÈªÑ</button>
    <button onclick="setColor('green')">üü© Á∑ë</button>
  </div>
  <button class="search" onclick="filterWords()">Ê§úÁ¥¢</button>
  <div id="results"></div>

  <script>
    const gridElement = document.getElementById("grid");
    const rows = 6, cols = 5;
    let wordList = [];
    let activeCell = null;

    function createGrid() {
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const div = document.createElement("div");
          div.contentEditable = true;
          div.classList.add("cell");
          div.dataset.state = "empty";
          div.dataset.row = r;
          div.dataset.col = c;
          div.addEventListener("focus", () => activeCell = div);
          div.addEventListener("input", handleInput);
          div.addEventListener("keydown", handleKey);
          gridElement.appendChild(div);
        }
      }
    }

    function setColor(color) {
      if (!activeCell) return;
      const states = ["gray", "yellow", "green"];
      states.forEach(s => activeCell.classList.remove(s));
      activeCell.dataset.state = color;
      if (color !== "empty") activeCell.classList.add(color);
    }

    function handleInput(e) {
      const cell = e.target;
      let ch = cell.textContent.toUpperCase().replace(/[^A-Z]/g, "").slice(0, 1);
      cell.textContent = ch;
      placeCursorToEnd(cell);
      const next = getNextCell(cell);
      if (next) next.focus();
    }

    function handleKey(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        const row = parseInt(e.target.dataset.row);
        const col = parseInt(e.target.dataset.col);
        if (col === 4 && row < rows - 1) {
          const nextRowFirst = document.querySelector(`.cell[data-row='${row + 1}'][data-col='0']`);
          if (nextRowFirst) nextRowFirst.focus();
        }
      } else if (e.key === "Backspace") {
        const cell = e.target;
        if (cell.textContent === "") {
          const prev = getPrevCell(cell);
          if (prev) {
            prev.textContent = "";
            prev.focus();
          }
        }
      }
    }

    function getNextCell(cell) {
      const row = parseInt(cell.dataset.row);
      const col = parseInt(cell.dataset.col);
      if (col < cols - 1) return document.querySelector(`.cell[data-row='${row}'][data-col='${col + 1}']`);
      return null;
    }

    function getPrevCell(cell) {
      const row = parseInt(cell.dataset.row);
      const col = parseInt(cell.dataset.col);
      if (col > 0) return document.querySelector(`.cell[data-row='${row}'][data-col='${col - 1}']`);
      return null;
    }

    function placeCursorToEnd(el) {
      const range = document.createRange();
      const sel = window.getSelection();
      range.selectNodeContents(el);
      range.collapse(false);
      sel.removeAllRanges();
      sel.addRange(range);
    }

    async function loadWords() {
      const res = await fetch("wordle_words.json");
      wordList = await res.json();
    }

    function filterWords() {
      const greens = Array(5).fill(null);
      const yellows = Array(5).fill([]);
      const grays = new Set();

      const cells = gridElement.querySelectorAll(".cell");
      for (let i = 0; i < cells.length; i++) {
        const ch = cells[i].textContent.trim().toLowerCase();
        const state = cells[i].dataset.state;
        const col = i % 5;

        if (!ch.match(/^[a-z]$/)) continue;

        if (state === "green") greens[col] = ch;
        else if (state === "yellow") yellows[col] = [...(yellows[col] || []), ch];
        else if (state === "gray") grays.add(ch);
      }

      const result = wordList.filter(word => {
        for (let i = 0; i < 5; i++) {
          if (greens[i] && word[i] !== greens[i]) return false;
          if (yellows[i] && yellows[i].some(y => word[i] === y || !word.includes(y))) return false;
        }
        for (const g of grays) {
          if (greens.includes(g)) continue;
          if (word.includes(g)) return false;
        }
        return true;
      });

      document.getElementById("results").innerHTML =
        `<h3>ÂÄôË£ú (${result.length}‰ª∂):</h3><ul>` +
        result.map(w => `<li>${w}</li>`).join("") +
        "</ul>";
    }

    createGrid();
    loadWords();
  </script>
</body>
</html>